while {
	await Ac.probe()==0 & Bc.probe()==0 {
		s,co = Ad.probe() + Bd.probe() + ci
		Sc.send(0) and Sd.send(s); ci=co
		Ac.recv() and Ad.recv() and Bc.recv() and Bd.recv()
	} or await Ac.probe()==0 & Bc.probe()==1 {
		s,co = Ad.probe() + Bd.probe() + ci
		Sc.send(0) and Sd.send(s); ci=co
		Ac.recv() and Ad.recv()
	} or await Ac.probe()==1 & Bc.probe()==0 {
		s,co = Ad.probe() + Bd.probe() + ci
		Sc.send(0) and Sd.send(s); ci=co
		Bc.recv() and Bd.recv()
	} or await Ac.probe()==1 & Bc.probe()==1 & co~=ci {
		s,co = Ad.probe() + Bd.probe() + ci
		Sc.send(0) and Sd.send(s); ci=co
	} or await Ac.probe()==1 & Bc.probe()==1 & co==ci {
		s,co = Ad.probe() + Bd.probe() + ci
		Sc.send(1) and Sd.send(s); ci=0
		Ac.recv() and Ad.recv() and Bc.recv() and Bd.recv()
	}
}
